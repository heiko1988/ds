<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools-Übersicht im Web-Ordner</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .new { background-color: #ffff99; } /* Hervorhebung für neue Tools */
        #notification { color: red; font-weight: bold; margin-bottom: 10px; display: none; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>Übersicht über Tools im /web-Ordner</h1>
    <p>Stand: <span id="timestamp"></span> | Diese Seite lädt dynamisch die Liste von GitHub und überprüft auf neue Dateien (basierend auf LocalStorage in deinem Browser). Web-Links führen zur live Seite (GitHub Pages), GitHub-Links zum Code.</p>
    <div id="notification"></div>
    <table id="tools-table">
        <thead>
            <tr>
                <th>Dateiname</th>
                <th>Web-Link (GitHub Pages)</th>
                <th>GitHub-Link (Code)</th>
                <th>Kurze Info</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        const repo = 'heiko1988/ds';
        const path = 'web';
        const apiUrl = `https://api.github.com/repos/${repo}/contents/${path}`;
        const selfFile = 'index.html'; // Ändere das, falls du die Datei umbenennst
        const basePagesUrl = 'https://heiko1988.github.io/ds/web/';

        async function fetchTools() {
            try {
                // Ordner-Inhalt fetchen
                const response = await fetch(apiUrl);
                const files = await response.json();

                // Nur .html-Dateien filtern, exklusive dieser Datei selbst
                const htmlFiles = files.filter(f => f.name.endsWith('.html') && f.name !== selfFile);

                // Letzte bekannte Liste aus LocalStorage holen
                const lastFiles = JSON.parse(localStorage.getItem('lastToolsList')) || [];
                const currentFiles = htmlFiles.map(f => f.name).sort();
                const newFiles = currentFiles.filter(name => !lastFiles.includes(name));

                // Benachrichtigung, wenn neu
                const notification = document.getElementById('notification');
                if (newFiles.length > 0) {
                    notification.textContent = `Neue Tools hinzugefügt: ${newFiles.join(', ')}`;
                    notification.style.display = 'block';
                }

                // Neue Liste speichern
                localStorage.setItem('lastToolsList', JSON.stringify(currentFiles));

                // Tabelle bauen
                const tbody = document.querySelector('#tools-table tbody');
                tbody.innerHTML = ''; // Leeren
                for (const file of htmlFiles) {
                    const row = document.createElement('tr');
                    if (newFiles.includes(file.name)) {
                        row.classList.add('new');
                    }

                    // Dateiname
                    const nameCell = document.createElement('td');
                    nameCell.textContent = file.name;
                    row.appendChild(nameCell);

                    // Web-Link (GitHub Pages)
                    const webCell = document.createElement('td');
                    const webLink = document.createElement('a');
                    webLink.href = basePagesUrl + file.name;
                    webLink.textContent = 'Live-Seite öffnen';
                    webLink.target = '_blank'; // In neuem Tab
                    webCell.appendChild(webLink);
                    row.appendChild(webCell);

                    // GitHub-Link (Code)
                    const githubCell = document.createElement('td');
                    const githubLink = document.createElement('a');
                    githubLink.href = file.html_url;
                    githubLink.textContent = 'Code ansehen';
                    githubLink.target = '_blank'; // In neuem Tab
                    githubCell.appendChild(githubLink);
                    row.appendChild(githubCell);

                    // Kurze Info (Title + Beschreibung aus Inhalt)
                    const infoCell = document.createElement('td');
                    const content = await fetch(file.download_url).then(res => res.text());
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(content, 'text/html');
                    const title = doc.querySelector('title')?.textContent.trim() || 'Kein Title';
                    const descElem = doc.querySelector('h1, p'); // Erstes H1 oder P
                    const description = descElem?.textContent.trim().slice(0, 100) + '...' || 'Keine Beschreibung verfügbar';
                    infoCell.textContent = `${title}: ${description}`;
                    row.appendChild(infoCell);

                    tbody.appendChild(row);
                }

                // Timestamp setzen
                document.getElementById('timestamp').textContent = new Date().toLocaleString('de-DE');
            } catch (error) {
                console.error('Fehler beim Laden:', error);
                document.querySelector('#tools-table tbody').innerHTML = '<tr><td colspan="4">Fehler beim Laden der Daten. Probiere es später erneut.</td></tr>';
            }
        }

        // Beim Laden ausführen
        fetchTools();
    </script>
</body>
</html>
