<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è St√§mme Bash-Rechner 80/120% (DEB20 & Co.)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        body { background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%); color: #fff; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .container { max-width: 800px; margin-top: 50px; }
        .card { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .btn-calc { background: linear-gradient(45deg, #ff6b6b, #ee5a24); border: none; font-weight: bold; }
        .btn-calc:hover { transform: scale(1.05); box-shadow: 0 10px 20px rgba(255,107,107,0.4); }
        .alert-success { background: rgba(40,167,69,0.3); border: 1px solid #28a745; }
        .alert-danger { background: rgba(220,53,69,0.3); border: 1px solid #dc3545; }
        .range-bar { background: rgba(255,255,255,0.1); height: 20px; border-radius: 10px; overflow: hidden; }
        .range-fill { height: 100%; transition: width 0.5s; border-radius: 10px; }
        .lower { background: linear-gradient(90deg, #ffc107, #ffed4a); }
        .upper { background: linear-gradient(90deg, #28a745, #20c997); }
        .current { background: linear-gradient(90deg, #dc3545, #ff416c); }
        #ergebnis { min-height: 200px; }
        .info-icon { cursor: pointer; color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <div class="text-center mb-5">
            <h1 class="display-4 fw-bold mb-3"><i class="fas fa-shield-alt me-3"></i>St√§mme Bash-Rechner</h1>
            <p class="lead">80/120% Regel ‚Äì F√ºr DEB20 & alle Battle-Welten <br><small class="text-muted">Eingaben: Deine Punkte (Angreifer) & Ziel-Punkte</small></p>
        </div>

        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card p-4 mb-4">
                    <div class="row g-3">
                        <div class="col-md-5">
                            <label class="form-label fw-bold"><i class="fas fa-user-tie me-2"></i>Deine Punkte (Angreifer)</label>
                            <input type="number" class="form-control form-control-lg text-center fw-bold" id="pa" value="39023" min="1" placeholder="z.B. 39.023">
                        </div>
                        <div class="col-md-5">
                            <label class="form-label fw-bold"><i class="fas fa-target me-2"></i>Ziel-Punkte</label>
                            <input type="number" class="form-control form-control-lg text-center fw-bold" id="pz" value="26266" min="1" placeholder="z.B. 26.266">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button class="btn btn-calc btn-lg w-100" onclick="berechne()">
                                <i class="fas fa-calculator me-2"></i>Rechnen!
                            </button>
                        </div>
                    </div>
                </div>

                <div id="ergebnis" class="card p-4">
                    <div class="text-center">
                        <div class="spinner-border text-primary mb-3" role="status" id="loader" style="display:none;">
                            <span class="visually-hidden">L√§dt...</span>
                        </div>
                        <h2 id="status" class="mb-4"></h2>
                        <p id="action" class="fs-4 fw-bold mb-4"></p>
                        <div id="range-viz" class="mb-4"></div>
                        <div class="row text-center">
                            <div class="col-md-4">
                                <div class="h3 fw-bold" id="ratio">0%</div>
                                <small>Aktuelles Verh√§ltnis</small>
                            </div>
                            <div class="col-md-4">
                                <div class="h3 fw-bold" id="diff">0</div>
                                <small>Punkte Delta</small>
                            </div>
                            <div class="col-md-4">
                                <div class="h3 fw-bold" id="target">0</div>
                                <small>Ziel-Punkte</small>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="card p-4">
                            <h5><i class="fas fa-info-circle me-2"></i>Die Regel erkl√§rt</h5>
                            <ul class="small">
                                <li><strong>Formel:</strong> max(P_a, P_z) ‚â§ ‚åämin(P_a, P_z) √ó 1,2‚åã</li>
                                <li><strong>Range f√ºr Angreifer:</strong> ‚åàP_z / 1,2‚åâ bis ‚åäP_z √ó 1,2‚åã</li>
                                <li><strong>Symmetrisch:</strong> ~83,3% bis 120% des Ziels</li>
                                <li>Live-Check im Spiel: Angriffsfenster!</li><grok-card data-id="a671e7" data-type="citation_card"></grok-card>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card p-4">
                            <h5><i class="fas fa-hammer me-2"></i>Abbau-Tipps (schnellste Methode!)</h5>
                            <ul class="small">
                                <li><strong>Abriss (HQ ‚â•15):</strong> Werkstatt, Marktplatz, Schmiede ‚Äì parallel in allen D√∂rfern!</li>
                                <li><strong>~Punkte-Beispiele:</strong> Marktplatz 25: 1.800 | Werkstatt 15: 1.200 | Schmiede 20: 1.500</li>
                                <li><a href="https://ds-ultimate.de/de/tools/pointCalc" target="_blank" class="text-warning">‚Üí Punkterechner</a> f√ºr exakt!</li>
                                <li><strong>Vermeide:</strong> Kaserne/Stall/Minen ‚Äì Off/Prod killen!</li>
                                <li>Premium f√ºr Speed! Warte ggf. auf Ziel-Wachstum.</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card p-4 mt-4">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Warnungen</h5>
                    <ul class="small">
                        <li>Abbau schw√§cht Pop/Bau ‚Äì nur f√ºr Rimshots!</li>
                        <li>Illegales (Buddy-Feed): Ban-Risiko!</li>
                        <li>DEB20-Speed: Abriss in Stunden fertig.</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function berechne() {
            const loader = document.getElementById('loader');
            const ergebnis = document.getElementById('ergebnis');
            loader.style.display = 'block';
            ergebnis.classList.add('opacity-50');
            setTimeout(() => {
                const pa = parseInt(document.getElementById('pa').value) || 0;
                const pz = parseInt(document.getElementById('pz').value) || 0;
                if (pa <= 0 || pz <= 0) {
                    document.getElementById('status').innerHTML = '‚ùå Ung√ºltige Eingabe!';
                    loader.style.display = 'none';
                    ergebnis.classList.remove('opacity-50');
                    return;
                }

                const minP = Math.min(pa, pz);
                const maxP = Math.max(pa, pz);
                const maxAllowed = Math.floor(minP * 120 / 100);
                const isAllowed = maxP <= maxAllowed;
                const ratio = ((maxP / minP) * 100).toFixed(1) + '%';
                const lowerBound = Math.ceil(pz * 100 / 120);
                const upperBound = Math.floor(pz * 120 / 100);

                let statusHtml = isAllowed ? '<i class="fas fa-check-circle text-success fs-1"></i><br>‚úÖ ANGRIFF ERLAUBT!' : '<i class="fas fa-times-circle text-danger fs-1"></i><br>‚ùå ANGRIFF GESPERRT!';
                document.getElementById('status').innerHTML = statusHtml;

                let actionHtml = '';
                let diff = 0;
                let target = pa;
                if (isAllowed) {
                    actionHtml = '<i class="fas fa-thumbs-up text-success me-2"></i><strong>Perfekt im Korridor!</strong><br>Du kannst direkt angreifen.';
                } else if (pa > pz) {
                    target = upperBound;
                    diff = pa - target;
                    actionHtml = `<i class="fas fa-hammer text-warning me-2"></i>Abbau n√∂tig:<br>
                                  <strong>${diff.toLocaleString('de-DE')}</strong> Punkte<br>
                                  auf <strong>${target.toLocaleString('de-DE')}</strong>`;
                } else {
                    target = lowerBound;
                    diff = target - pa;
                    actionHtml = `<i class="fas fa-plus-circle text-info me-2"></i>Bau n√∂tig:<br>
                                  <strong>${diff.toLocaleString('de-DE')}</strong> Punkte<br>
                                  auf <strong>${target.toLocaleString('de-DE')}</strong> (Untergrenze)`;
                }
                document.getElementById('action').innerHTML = actionHtml;
                document.getElementById('ratio').textContent = ratio;
                document.getElementById('diff').textContent = diff === 0 ? '0' : (diff > 0 ? '+' + diff.toLocaleString('de-DE') : diff.toLocaleString('de-DE'));
                document.getElementById('target').textContent = target.toLocaleString('de-DE');

                // Range-Bar visualisieren
                const totalWidth = upperBound - lowerBound + 1;
                const paPos = ((pa - lowerBound) / totalWidth) * 100;
                let vizHtml = `
                    <div class="range-bar mb-2">
                        <div class="range-fill lower" style="width: ${Math.min(100, (pz > pa ? 100 : (pa <= upperBound ? paPos : 100)))}%"></div>
                        <div class="range-fill upper" style="width: ${100 - Math.min(100, paPos)}%; margin-left: ${Math.min(100, paPos)}%"></div>
                    </div>
                    <small class="text-muted">
                        Range f√ºr dich: <strong>${lowerBound.toLocaleString('de-DE')}</strong> &mdash; <strong>${upperBound.toLocaleString('de-DE')}</strong>
                        ${pa < lowerBound ? '<span class="text-info">‚Üê Bauen</span>' : pa > upperBound ? '<span class="text-warning">Abbauen ‚Üí</span>' : '<span class="text-success">Im Range!</span>'}
                    </small>`;
                document.getElementById('range-viz').innerHTML = vizHtml;

                loader.style.display = 'none';
                ergebnis.classList.remove('opacity-50');
            }, 500);
        }

        // Auto-calc on enter
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('pa').addEventListener('keypress', (e) => { if (e.key === 'Enter') berechne(); });
            document.getElementById('pz').addEventListener('keypress', (e) => { if (e.key === 'Enter') berechne(); });
            berechne(); // Initial mit Beispielen
        });
    </script>
</body>
</html>
